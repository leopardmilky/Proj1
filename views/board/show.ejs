<% layout('layouts/boilerplate') %>
<div class="container d-flex flex-column align-items-center mt-5">
    <div class="card d-inline mb-3 w-75 py-1 border-start-0 border-end-0 border-bottom-0">
        <p id="show_title" class="m-0 py-3 px-3"><strong><%= items.title %></strong></p>
        <div id="content_info" class="d-flex justify-content-between px-3 py-2 mt-0 border border-start-0 border-end-0 bg-light">
            <div>
                <span class="align-middle"><%= items.author.nickname %>&nbsp;&nbsp;</span><span class="align-middle">|&nbsp;&nbsp;<%= items.createdAt.getFullYear() %>-<%= String(items.createdAt.getMonth()+1).padStart(2,'0') %>-<%= String(items.createdAt.getDate()).padStart(2,'0') %> <%= String(items.createdAt.getHours()).padStart(2,'0') %>:<%= String(items.createdAt.getMinutes()).padStart(2,'0') %>:<%= String(items.createdAt.getSeconds()).padStart(2,'0') %></span>
            </div>
            <% if(signedInUser && items.author.equals(signedInUser._id)) { %>
            <div class="d-flex justify-content-end">
                <a class="p-1 me-1 btn btn-outline-warning btn-sm" href="/index/<%= items._id %>/edit">수정</a>
                <form action="/index/<%= items._id %>?_method=DELETE" method="POST">
                    <button class="p-1 btn btn-outline-danger btn-sm">삭제</button>
                </form>
            </div>
            <% } %>
        </div>
        <p class="px-3 py-3 m-0"><%= items.mainText %></p>
        <div class="d-flex px-3 justify-content-end border border-start-0 border-end-0 bg-light">
            
            <a class="p-1 me-1 btn btn-outline-secondary btn-sm" href="/index">목록</a>
            <a class="p-1 btn btn-outline-danger btn-sm" href="#">신고</a>
        </div>
    </div>
    <div class="card d-inline w-75 mb-3 border border-2 border-start-0 border-end-0 border-top-0 bg-light">
        <p class="m-0 mt-1 py-0 px-3"><strong id="comments_color"><%= items.comments.length %></strong> Comments</p>
    </div>
        <% for (comment of items.comments) { %>
        <div class="card mb-3 w-75 border-start-0 border-end-0 border-top-0 commentWrap">
            <div class="d-flex justify-content-between px-3 mb-3 comment_info">
                <span><b><%= comment.author.nickname %></b></span>
                <span><%= comment.createdAt.getFullYear() %>-<%= String(comment.createdAt.getMonth()+1).padStart(2,'0') %>-<%= String(comment.createdAt.getDate()).padStart(2,'0') %> <%= String(comment.createdAt.getHours()).padStart(2,'0') %>:<%= String(comment.createdAt.getMinutes()).padStart(2,'0') %>:<%= String(comment.createdAt.getSeconds()).padStart(2,'0') %></span>
            </div>
            <div class="d-flex justify-content-between px-3 mb-1">
                <p id="comment_body"><%= comment.body %></p>
            </div> 
            <div class="d-flex justify-content-end px-3 mb-3">
                <% if (signedInUser && comment.author.equals(signedInUser._id)) { %>
                    <a class="btn btn-outline-warning btn-sm p-1 me-1 commentEditBtn" data-comment-id="<%= comment._id %>" href="#">수정</a>
                    <form action="/index/<%= items._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
                        <button class="btn btn-outline-danger btn-sm p-1">삭제</button>
                    </form>
                <% } else { %>
                    <a class="btn btn-outline-danger btn-sm p-1" href="#">신고</a>
                <% } %>
            </div>
            <!-- <div class="mb-3 px-3">
                <form action="">
                    <label class="form label w-100" for="body">Edit Comment</label>
                    <textarea class="form-control" name="" id="" cols="30" rows="3"></textarea>
                    <div class="d-flex justify-content-end mt-1">
                        <span class="btn btn-outline-warning btn-sm p-1 me-1">등록</span>
                        <span class="btn btn-outline-secondary btn-sm p-1">취소</span>
                    </div>
                </form>
            </div> -->
        </div>
        <% } %>
    
    <div class="row w-75 mb-3 bg-light" >
        <% if(!signedInUser) { %>
            <div class="p-5 d-flex flex-column align-items-center justify-content-center">
                <span>댓글 작성은 <a href="/signin">로그인</a>이 필요합니다.</span>
            </div>
        <% } else { %>
            <form class="d-flex flex-column align-items-center justify-content-center validated-form" action="/index/<%= items._id %>/comments" method="POST" novalidate>
                <label class="form label w-100" for="body">Comment</label>
                <textarea class="form-control" name="comment[body]" id="body" cols="10" rows="5" required></textarea>
                <button class="w-100 btn btn-success btn-sm">등록</button>
            </form>
        <% } %>
    </div>
</div>



<script>
    document.addEventListener('click', function(event){
        if(event.target.classList.contains('commentEditBtn')){
            const commentId = event.target.getAttribute('data-comment-id');
            console.log(commentId);
            
            const parenEle = event.target.parentElement.parentElement;
            console.log(parenEle);

            event.target.style.display = 'none';

            const a = document.createElement('div');
            const b = document.createElement('label');
            const c = document.createElement('textarea');
            const d = document.createElement('div');
            const e = document.createElement('span');
            const f = document.createElement('span');

            a.setAttribute('class', 'mb-3 px-3');
            b.setAttribute('class', 'form label w-100');
            c.setAttribute('class', 'form-control');
            d.setAttribute('class', 'd-flex justify-content-end mt-1');
            e.setAttribute('class', 'btn btn-outline-warning btn-sm p-1 me-1');
            e.innerHTML = "등록";
            f.setAttribute('class', 'btn btn-outline-secondary btn-sm p-1');
            f.innerHTML = "취소";

            const atag = parenEle.appendChild(a);
            const btag = atag.appendChild(b);
            const ctag = atag.appendChild(c);
            const dtag = atag.appendChild(d);
            const etag = dtag.appendChild(e);
            const ftag = dtag.appendChild(f);
            
        }
    })
    




    
    // const editbtns = document.querySelectorAll('.editComment');
    // for(let editbtn of editbtns ){
    //     editbtn.addEventListener('click', function(){
    //         const item = this.getAttribute('data-comment-id');
    //         console.log(item);
    //     })
    // }

</script>